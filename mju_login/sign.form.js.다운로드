$(document).ready(function() {
	
	$('#signin-form').submit(function(event) { 
		
		// prevent multi click
		try{
			var $submitBtn = $('button[type="submit"]', this);	
			
			if($submitBtn .length == 0) {
				$submitBtn = $('input[type="submit"]', this);	
			}
			
			$submitBtn.attr('disabled', 'disabled');
			
			setTimeout(function() { $submitBtn.removeAttr('disabled')}, 1000);
		} catch(e) {}
		 
		var userId = $('#input-userId').val();
	    var pw = $('#input-password').val();
	    
	    var alkId = $('#input-alk_id').val();
		
		if( isEmptyString(userId) && isEmptyString(alkId) ) {
            alert('User Id or Alk Id is Empty!');
            $("#input-userId").val('');
            return false;
        }
        
        var publicKeyStr = $('#public-key').val();
		
		if( publicKeyStr && publicKeyStr.length > 10) {
			/* 공개키가 있을 경우 처리 */
			bandiJS.setPublicKey(publicKeyStr);
			
			var curTime = new Date().getTime();
            var keyInfo = bandiJS.genKey(32);
            var encKey = bandiJS.encryptJavaPKI(keyInfo.keyStr + ',' + curTime);
            /* var encKey = bandiJS.encryptJavaPKI(keyInfo.keyStr);*/
            $("#input-encsymka").val(encKey); 
            
            if( !isEmptyString(pw) ) {
                var encPw = bandiJS.encryptBase64AES(pw.trim(), keyInfo);
                $("#input-password-enc").val(encPw);
                $("#input-password").val('');
            }
                  
            if( !isEmptyString(alkId) ) {
                var encAlkId = bandiJS.encryptBase64AES(alkId.trim(), keyInfo, true);
                $("#input-alk_id-enc").val(encAlkId);
                $('#input-alk_id').val('');
            }
            
            bandiJS.deleteKey(keyInfo);
            
			/*
            var encUserId = bandiJS.encryptJavaPKI(userId.trim());
            $("#input-userId-enc").val(encUserId);
            
            */ 
	        
	        /* $("#input-userId").val(''); */
	       
		}
		
		return true; 
	});
});

