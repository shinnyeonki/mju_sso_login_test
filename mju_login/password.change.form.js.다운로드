$(document).ready(function() {

	$('#password-change-form').submit(function(event) { 
	
	    if( 'Y' == $('#delay_input').val() ) {
	       return true;
	    }
		
		// prevent multi click
		try{
			var $submitBtn = $('button[type="submit"]', this);	
			
			if($submitBtn.length == 0) {
				$submitBtn = $('input[type="submit"]', this);	
			}
			
			$submitBtn.attr('disabled', 'disabled');
			
			setTimeout(function() { $submitBtn.removeAttr('disabled')}, 1000);
		} catch(e) {}
		
		var pw = $('#input-password').val();
        var newPw = $('#input-new-password').val();
        var confirmPw = $('#input-confirm-password').val();
        
        if( newPw !== confirmPw ) {
        	alert('Passwords not Match!')
        	return false;
        }
		
		if(pwdValidation() == false) {
			return false;
		}
		
		var publicKeyStr = $('#public-key').val();
		
		if( publicKeyStr && publicKeyStr.length > 10) {
			/* 공개키가 있을 경우 처리 */
			bandiJS.setPublicKey(publicKeyStr);
			
			var curTime = new Date().getTime();
            var keyInfo = bandiJS.genKey(32);
            var encKey = bandiJS.encryptJavaPKI(keyInfo.keyStr + ',' + curTime);
            /* var encKey = bandiJS.encryptJavaPKI(keyInfo.keyStr);*/
			
			if(encPw) {			
            	var encPw = bandiJS.encryptBase64AES(pw.trim(), keyInfo);
            	$('#input-password-enc').val(encPw);
            	$('#input-password').val('');
            } 
            var encNewPw = bandiJS.encryptBase64AES(newPw.trim(), keyInfo);

            $("#input-encsymka").val(encKey);
	        $('#input-new-password-enc').val(encNewPw);
	        
	        $('#input-new-password').val('');
	        $('#input-confirm-password').val('');
	        
	        bandiJS.deleteKey(keyInfo);
		}
		
		return true; 
	});
});

